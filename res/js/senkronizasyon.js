var Filo_Senkronizasyon={BOLGELER:{A:"dk_oasa",B:"dk_oasb",C:"dk_oasc"},REFRESH_INTERVAL_FREKANS:7e3,DB_KAYDET_INTERVAL_FREKANS:1e3,OTO_REFRESH_FREKANS:1800,REQUEST_COUNTER:0,TOTAL_REQ_COUNT:0,SENKRONIZASYON_YAPILIYOR:!1,ITEM_DATA:{},FORM_DATA:new FormData,STATUS:"",DB_KAYDET_INTERVAL:!1,REFRESH_INTERVAL:!1,OTOBUSLER:{},SON_UNIX:0,GUNCELLE_FLAG:!1,REFRESH_AFTER_CB:!1,MANUEL_TETIK_FLAG:!1,HATLAR:[],INIT:function(a,b){this.OTOBUSLER=a,this.SON_UNIX=b,this.REFRESH_INTERVAL=setInterval(this.Interval_Kontrol,this.REFRESH_INTERVAL_FREKANS)},Manuel_Tetik:function(a,b,c){clearInterval(this.REFRESH_INTERVAL),this.OTOBUSLER=a,this.OTO_REFRESH_FREKANS=b,this.SON_UNIX=Math.floor(Date.now()/1e3),this.MANUEL_TETIK_FLAG=!0,this.REFRESH_INTERVAL=setInterval(this.Interval_Kontrol,this.REFRESH_INTERVAL_FREKANS),this.REFRESH_AFTER_CB=c},ORER_Refresh:function(a,b){console.log("Güncelleniyor"),show($AH("header-loader")),clearInterval(this.REFRESH_INTERVAL),this.OTOBUSLER=a,this.DB_KAYDET_INTERVAL=setInterval(this.DB_Kaydet,this.DB_KAYDET_INTERVAL_FREKANS),this.FORM_DATA=new FormData,this.ITEM_DATA={},this.SENKRONIZASYON_YAPILIYOR=!0,this.FORM_DATA.append("type","filo_orer_senkronizasyon"),this.FORM_DATA.append("log_type",b);for(var c in this.OTOBUSLER){this.ITEM_DATA[c]={};for(var d=0;d<this.OTOBUSLER[c].length;d++)this.ORER_Request(d,c),this.TOTAL_REQ_COUNT++}},ORER_Request:function(a,b){var c=[];"Bölge: "+b+" /  KapıNo: "+this.OTOBUSLER[b][a];this.ITEM_DATA[b][this.OTOBUSLER[b][a]]=[],AHAJAX_V3_TEXT.req("http://ahsaphobby.net/otobus/iett/filo_veri_download/request.php",manual_serialize({type:"filo_orer_guncelle",bolge:b,kapi_no:this.OTOBUSLER[b][a]}),function(d){c=[],set_html($AH("senkronizasyon_container"),d);for(var e=find_elem($AH("senkronizasyon_container"),"tbody").childNodes,f=0;f<e.length;f++)(hasClass(e[f],"yazid")||hasClass(e[f],"yazim")||hasClass(e[f],"yazit")||hasClass(e[f],"yazik")||hasClass(e[f],"yazi"))&&c.push(e[f]);var g;if(c.length>0)for(var h=0;h<c.length;h++){g=c[h].childNodes;var i=c[h].innerHTML,j=g[1].innerText.trim();j.indexOf("*")>-1?(j=j.substr(1),j=j.substr(0,j.indexOf("*"))):j.indexOf("!")>-1?(j=j.substr(1),j=j.substr(0,j.indexOf("!"))):j.indexOf("#")>-1&&(j=j.substr(1),j=j.substr(0,j.indexOf("#")));var k=g[3].innerText.trim();k.indexOf(" ")>-1&&(k=k.substr(0,k.indexOf(" "))),Filo_Senkronizasyon.ITEM_DATA[b][Filo_Senkronizasyon.OTOBUSLER[b][a]].push(JSON.stringify({no:g[0].innerText.trim(),hat:j,servis:g[2].innerText.trim(),guzergah:k,oto:g[4].innerText.trim().substr(2),surucu:g[5].innerText.trim().substr(1),gelis:g[6].innerText.trim(),orer:g[7].innerText.trim(),amir:g[8].innerText.trim(),gidis:g[9].innerText.trim(),tahmin:g[10].innerText.trim(),bitis:g[11].innerText.trim(),durum_kodu:g[13].innerText.substr(6).trim(),sure:i.substr(i.indexOf("Sefer süresi:")+14,i.indexOf("dk.")-i.indexOf("Sefer süresi:")-14).trim(),durum:g[12].innerText.trim()}))}else Filo_Senkronizasyon.ITEM_DATA[b][Filo_Senkronizasyon.OTOBUSLER[b][a]]="BOS";Filo_Senkronizasyon.REQUEST_COUNTER++})},ORER_Sefer_Takip:function(a,b){show($AH("header-loader"));var c=[],d=this.BOLGELER[a.substr(0,1)];AHAJAX_V3_TEXT.req("http://ahsaphobby.net/otobus/iett/filo_veri_download/request.php",manual_serialize({type:"filo_orer_guncelle",bolge:d,kapi_no:a}),function(a){c=[],set_html($AH("senkronizasyon_container"),a);var d=find_elem($AH("senkronizasyon_container"),"tbody").childNodes;if(void 0!=d){for(var e=0;e<d.length;e++)(hasClass(d[e],"yazid")||hasClass(d[e],"yazim")||hasClass(d[e],"yazik")||hasClass(d[e],"yazi"))&&c.push(d[e]);var f;if(c.length>0)for(var g=0;g<c.length;g++)if(f=c[g].childNodes,"A"==f[12].innerText){if(f[3].innerHTML.indexOf("Durak izdusumu")>-1)var h=f[3].innerHTML.substr(f[3].innerHTML.indexOf("Durak izdusumu: ")+16,f[3].innerHTML.indexOf(" ve ilk Durak")-f[3].innerHTML.indexOf("Durak izdusumu: ")-16);if(f[7].innerHTML.indexOf("Sonraki Sefer Saati")>-1)var i="Beklenen ortalama tamamlama saati: "+f[7].innerHTML.substr(f[7].innerHTML.indexOf("Beklenen ortalama tamamlama saati  :")+36,f[7].innerHTML.indexOf("Beklenen ortalama tamamlama saati  :")+41-f[7].innerHTML.indexOf("Beklenen ortalama tamamlama saati  :")-36)}void 0==h&&(h="Veri yok."),void 0==i&&(i="Veri yok."),b(h,i),hide($AH("header-loader"))}})},ORER_Harita_Takip_Refresh:function(a){},ORER_Harita_Takip_Request:function(){},DB_Kaydet:function(){Filo_Senkronizasyon.SENKRONIZASYON_YAPILIYOR&&Filo_Senkronizasyon.REQUEST_COUNTER>0&&Filo_Senkronizasyon.REQUEST_COUNTER==Filo_Senkronizasyon.TOTAL_REQ_COUNT&&(Filo_Senkronizasyon.FORM_DATA.append("items",JSON.stringify(Filo_Senkronizasyon.ITEM_DATA)),console.log("Veritabanına kaydediliyor.."),AHAJAX_V3.req(Base.AJAX_URL+"filo_senkronizasyon.php",Filo_Senkronizasyon.FORM_DATA,function(a){console.log("VT Güncel"),console.log(a),Filo_Senkronizasyon.MANUEL_TETIK_FLAG?Filo_Senkronizasyon.SON_UNIX=Math.floor(Date.now()/1e3):Filo_Senkronizasyon.SON_UNIX=a.son_unix,Filo_Senkronizasyon.REFRESH_INTERVAL=setInterval(Filo_Senkronizasyon.Interval_Kontrol,Filo_Senkronizasyon.REFRESH_INTERVAL_FREKANS),hide($AH("header-loader")),"function"==typeof Filo_Senkronizasyon.REFRESH_AFTER_CB&&Filo_Senkronizasyon.REFRESH_AFTER_CB(Filo_Senkronizasyon.ITEM_DATA)}),console.log(Filo_Senkronizasyon.ITEM_DATA),clearInterval(Filo_Senkronizasyon.DB_KAYDET_INTERVAL),Filo_Senkronizasyon.REQUEST_COUNTER=0,Filo_Senkronizasyon.TOTAL_REQ_COUNT=0,Filo_Senkronizasyon.SENKRONIZASYON_YAPILIYOR=!1,set_html($AH("senkronizasyon_container"),""))},Interval_Kontrol:function(){console.log("Güncelleme kontrolü ( Kalan süre : "+(Filo_Senkronizasyon.OTO_REFRESH_FREKANS-(Math.floor(Date.now()/1e3)-Filo_Senkronizasyon.SON_UNIX))+" saniye )"),Math.floor(Date.now()/1e3)-Filo_Senkronizasyon.SON_UNIX>=Filo_Senkronizasyon.OTO_REFRESH_FREKANS&&Filo_Senkronizasyon.ORER_Refresh(Filo_Senkronizasyon.OTOBUSLER,"komple")}};